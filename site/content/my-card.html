---
title: My Membership
---

<div id="buttonDiv"></div>

<p id="membershipResult"></p>


<script src="https://accounts.google.com/gsi/client" async></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jose/5.9.6/index.umd.min.js" async></script>

<script>
  function handleCredentialResponse(response) {
    console.log("Encoded JWT ID token: " + response.credential);
  }
  window.onload = function () {
    google.accounts.id.initialize({
      client_id: "345624515172-dc7nehemc3r77bn47icdmo3vf066h20t.apps.googleusercontent.com",
      callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
      document.getElementById("buttonDiv"),
      { theme: "outline", size: "large" }
    );
  }

  function decodeJwtResponse(jwt) {
    const claims = jose.decodeJwt(jwt)
    return claims
  }

  function handleCredentialResponse(response) {
    const responsePayload = decodeJwtResponse(response.credential);

    fetch(`https://wrbc-members-345624515172.us-central1.run.app?email=${responsePayload.email}`)
      .then(function (response) {
        response.json().then(function(data){
          if (data.length === 1){
            window.location.href = `/members/${data[0].id}`;
            return;
          } else if (data.length === 2){
            const member = pickMember(data);
            document.getElementById['card'].src = `/members/${member.id}`;
            return;
          } 
        })
      })
      .catch(function (err) {
        console.log('Fetch Error :', err);
        document.getElementById('membershipResponse').innerHTML = "error checking membership";
      });
  }

  const pick = document.getElementById('pickMember');
  function pickMember(data){
    const options = pick.getElementsByTagName('option');
    options[0].innerHTML = data[0].name;
    options[1].innerHTML = data[1].name;
    pick.returnValue = 'member';
    pick.showModal();

  }

// Form cancel button closes the dialog box
cancelButton.addEventListener("click", () => {
  pick.close("memberNotChosen");
});
</script>

<dialog id="pickMember">
  <form method="dialog">
    <p>
      <label for="member">Which Member:</label>
      <select id="member" name="member">
        <option>1</option>
        <option>2</option>
      </select>
    </p>
    <div>
      <button id="cancel" type="reset">Cancel</button>
      <button type="submit">Confirm</button>
    </div>
  </form>
</dialog>
